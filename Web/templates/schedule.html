<html lang="zh">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>登录</title>

    <!-- Custom styles for this template-->
    <link href="../static/css/bootstrap.min.css" rel="stylesheet">

</head>

<body>
<!-- Fixed navbar -->
<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/user_info">中国农业大学研究生课表</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li><a href="/disclaimer">免责说明</a></li>
                <li><a href="/contact">联系</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                       aria-expanded="false">Coming soon <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="/app">APP下载</a></li>
                        <li id="li"></li>
                    </ul>
                </li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</nav>
<br>
<br>
<div class="container">
    <div class="page-header">
        <h1 id="messageH1"><code id="messageCode"></code></h1>
        <hr>
        <div class="btn-group">
            <button class="btn btn-link btn-lg dropdown-toggle" type="button" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                <span>当前第</span>
                <span id="weekNowSpan" style="color: #5bc0de"></span>
                <span>周</span><span class="caret"></span>
            </button>
            <ul id="ul" class="dropdown-menu">

            </ul>
        </div>
        <table id="schedule" class="invisible">
            <thead>

            </thead>
            <tbody>

            </tbody>
        </table>
    </div>
</div>

<!-- Bootstrap core JavaScript-->
<script src="../static/js/jquery-3.6.0.min.js"></script>
<script src="../static/js/bootstrap.min.js"></script>

<script>
    week_no_now = 0;
    $(function () {
        isLogin()
        getWeekInfo()
        getSchedule(week_no_now)
    })

    function isLogin() {
        $.ajax({
            url: 'console/is_login',
            type: 'GET',
            success: function (data) {
                if (data.code === 0) {
                    // 已经登录了
                    let a = $("<a></a>").attr('href', '/console/logout').append("登出");
                    a.appendTo("#li");
                }
            }
        })
    }

    function getWeekInfo() {
        $("#ul").empty();
        $.ajax({
            url: '/console/week_info',
            type: 'GET',
            success: function (data) {
                if (data.code === 0) {
                    // 添加到下拉菜单
                    $("#weekNowSpan").text(data.message.week_now);
                    week_no_now = data.message.week_now;
                    for (let i = 1; i < parseInt(data.message.total_weeks) + 1; i++) {
                        let btn = $("<button></button>").attr('type', 'button').attr('weekNo', i)
                            .attr('class', 'btn btn-link btn-block weekBtn').append("第" + i + "周");
                        let li = $("<li></li>");
                        li.append(btn).appendTo("#ul");
                    }
                } else {
                    alert(data.message);
                }
            }
        });
        $('#ul').on('click', '.weekBtn', function () {
            getSchedule($(this).attr("weekNo"));
        });
    }

    function getSchedule(week_no) {
        $.ajax({
            url: '/console/schedule?week_no=' + week_no,
            type: 'GET',
            success: function (data) {
                if (data.code === 0) {
                    // 展示课表
                    $("#messageH1").attr('class', 'invisible');
                    // @TODO
                    $("#schedule").attr('class', 'visible');
                } else {
                    $("#messageCode").val(data.message);
                }
            }
        })
    }
</script>
</body>

</html>